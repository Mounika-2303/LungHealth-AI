<!-- templates/navbar.html -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand font-weight-bold" href="/">Lung Health</a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav mr-auto">

      {% if session.get('user') %}

        <!-- Dashboard -->
        <li class="nav-item">
          <a class="nav-link {{ 'active' if request.endpoint == 'dashboard' else '' }}"
             href="/">Dashboard</a>
        </li>

        <!-- Predict (GET /predict => endpoint 'index', POST / => endpoint 'patient') -->
        {% if session.get('role') == 'user' %}
        <li class="nav-item">
          <a class="nav-link {{ 'active' if request.endpoint in ['index', 'patient'] else '' }}"
             href="/predict">Predict</a>
        </li>
        {% elif session.get('role') == 'admin' %}
        <!-- Admin Panel (group common admin endpoints) -->
        <li class="nav-item">
          <a class="nav-link {{ 'active' if request.endpoint in [
                'admin_panel','admin_dashboard','admin',
                'view_users','view_all_users',
                'view_logs','admin_logs',
                'user_predictions','admin_user_predictions'
              ] else '' }}"
             href="/admin">Admin Panel</a>
        </li>
        {% endif %}

        <!-- Contact -->
        <li class="nav-item">
          <a class="nav-link {{ 'active' if request.endpoint == 'contact' else '' }}"
             href="/contact">Contact</a>
        </li>

        <!-- History -->
        <li class="nav-item">
          <a class="nav-link {{ 'active' if request.endpoint == 'history' else '' }}"
             href="/history">View History</a>
        </li>

        <!-- Change Password -->
        <li class="nav-item">
          <a class="nav-link {{ 'active' if request.endpoint == 'change_password' else '' }}"
             href="/change_password">Change Password</a>
        </li>
	
	<li class="nav-item">
  		<a class="nav-link {{ 'active' if request.endpoint == 'admin_messages' else '' }}" href="/admin/messages">
   		 	Messages</a>
	</li>


        <!-- Logout -->
        <li class="nav-item">
          <a class="nav-link" href="/logout">Logout</a>
        </li>

      {% else %}
        <!-- Guest links -->
        <li class="nav-item">
          <a class="nav-link {{ 'active' if request.endpoint == 'login' else '' }}"
             href="/login">Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {{ 'active' if request.endpoint == 'register' else '' }}"
             href="/register">Register</a>
        </li>
      {% endif %}
    </ul>

    {% if session.get('user') %}
      <span class="navbar-text ml-auto text-muted">
        Welcome, {{ session['user'] }}
      </span>
    {% endif %}
  </div>
</nav>
